<c-vars session_id="" chat_enabled="true" />
<div data-component="chat"
     data-session-id="{{ session_id }}"
     class="chat-window {{ class }}"
     {{ attrs }}>
  {# Messages container #}
  <div class="chat-messages"
       data-ref="messages"
       role="log"
       aria-live="polite"
       aria-label="Chat messages">
    {# User message template #}
    <template data-template="message-user">
      <div class="chat-message chat-message-user">
        <div class="chat-message-avatar">
          <c-atoms.icon name="user-circle" class="w-8 h-8 text-greyscale-400" />
        </div>
        <div class="chat-message-content">
          <div data-bind="content" class="chat-bubble chat-bubble-user"></div>
        </div>
      </div>
    </template>
    {# Assistant message template #}
    <template data-template="message-assistant">
      <div class="chat-message chat-message-assistant">
        <div class="chat-message-avatar">
          <c-atoms.icon name="chat-bubble-left-right" class="w-8 h-8 text-primary-600" />
        </div>
        <div class="chat-message-content">
          <div data-bind="content" class="chat-bubble chat-bubble-assistant"></div>
        </div>
      </div>
    </template>
    {# Typing indicator #}
    <div data-ref="typing" hidden class="chat-message chat-message-assistant">
      <div class="chat-message-avatar">
        <c-atoms.icon name="chat-bubble-left-right" class="w-8 h-8 text-primary-600" />
      </div>
      <div class="chat-message-content">
        <c-atoms.typing-indicator />
      </div>
    </div>
  </div>
  {# Input form #}
  <form method="post"
        action="{% url 'chat:stream' %}"
        class="chat-input-form">
    {% csrf_token %}
    <c-atoms.input data-ref="input" type="text" name="message" placeholder="Ask a legal question..." aria_label="Chat message" class="flex-1" />
    <c-atoms.button type="submit" variant="primary" size="xl" data-ref="submitBtn" aria_label="Send message">
    <c-atoms.icon name="paper-airplane" class="w-5 h-5" />
    <span class="hidden sm:inline ml-2">Send</span>
    </c-atoms.button>
  </form>
  {# Fallback search link #}
  {% if not chat_enabled %}
    <div class="chat-fallback-notice">
      <p class="text-sm text-greyscale-600">
        AI chat is currently unavailable.
        <c-atoms.link href="{% url 'chat:search' %}" variant="primary">Use keyword search</c-atoms.link>
      </p>
    </div>
  {% endif %}
</div>
