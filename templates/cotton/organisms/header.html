{% load static %}

<c-vars sticky="" />
<header data-component="appHeader"
        class="mobile-header flex-shrink-0 {% if sticky %}mobile-header-sticky{% endif %} {{ class }}"
        {{ attrs }}>
  <div class="mobile-header-inner">
    <a href="{% url 'portal:home' %}" aria-label="Home">
      <img src="{% static 'images/logo_powered.svg' %}"
           alt="Litigant Portal - Powered by Free Law Project"
           class="h-12" />
    </a>
    <div class="flex items-center gap-1 sm:gap-2">
      {% if debug %}
        <c-atoms.link href="{% url 'portal:style_guide' %}" variant="unstyled" class="hidden sm:inline-flex text-xs font-medium text-greyscale-400 hover:text-greyscale-600 transition-colors">
        Style Guide
        </c-atoms.link>
        <c-atoms.button type="button" variant="ghost" class="hidden sm:inline-flex text-xs font-medium text-greyscale-400 hover:text-red-500 !p-0" data-ref="clearDemo">
        Clear Demo
        </c-atoms.button>
      {% endif %}
      <c-molecules.user-menu class="hidden sm:flex" />
      <c-atoms.button type="button" variant="ghost" aria_label="Open activity timeline" class="mobile-header-menu-btn" aria-expanded="false" data-ref="openMenu">
      <c-atoms.icon name="bars-3" class="w-6 h-6" />
      </c-atoms.button>
    </div>
  </div>
  {# Timeline dialog â€” native <dialog> with slide-over positioning #}
  <dialog data-ref="dialog"
          class="timeline-dialog"
          aria-label="Activity timeline">
    <div class="timeline-dialog-panel">
      <div class="flex items-center justify-between p-4 border-b border-greyscale-200">
        <span class="font-semibold text-greyscale-900">Activity</span>
        <c-atoms.button type="button" variant="ghost" aria_label="Close menu" class="p-2 -mr-2 text-greyscale-500 hover:text-greyscale-700" data-ref="closeMenu">
        <c-atoms.icon name="x-mark" class="w-6 h-6" />
        </c-atoms.button>
      </div>
      {# Timeline content #}
      <div data-ref="events" class="p-4 space-y-3">
        {# Empty state #}
        <div data-ref="emptyState" class="text-center py-8">
          <c-atoms.icon name="clock" class="w-10 h-10 text-greyscale-300 mx-auto mb-3" />
          <p class="text-sm text-greyscale-500">No activity yet</p>
          <p class="text-xs text-greyscale-400 mt-1">Upload documents and chat to see your history here</p>
        </div>
        {# Timeline events (rendered via JS) #}
        <div data-ref="eventsList" hidden class="space-y-3">
          <template data-template="timelineEvent">
            <div data-bind="card" class="p-3 border-l-2 cursor-pointer">
              <div class="flex items-center gap-2 mb-1">
                <span data-icon="upload" hidden>
                  <c-atoms.icon name="document-arrow-up" class="w-4 h-4 text-primary-500" />
                </span>
                <span data-icon="summary" hidden>
                  <c-atoms.icon name="chat-bubble-left-right" class="w-4 h-4 text-blue-500" />
                </span>
                <span data-icon="change" hidden>
                  <c-atoms.icon name="pencil-square" class="w-4 h-4 text-greyscale-500" />
                </span>
                <p data-bind="time" class="text-xs text-greyscale-500"></p>
              </div>
              <p data-bind="title" class="text-sm font-medium text-greyscale-800"></p>
              <p data-bind="content" class="text-sm text-greyscale-600 line-clamp-2"></p>
            </div>
          </template>
        </div>
      </div>
      {# Account Section (mobile) #}
      <div class="p-4 border-t border-greyscale-200 sm:hidden">
        {% if user.is_authenticated %}
          <div class="mb-2 px-1 py-1 text-sm text-greyscale-600 truncate">{{ user.email }}</div>
          <c-atoms.nav-link icon="arrow-right-start-on-rectangle" href="{% url 'account_logout' %}" icon_bg="bg-greyscale-100" icon_color="text-greyscale-600">Sign out</c-atoms.nav-link>
        {% else %}
          <c-atoms.nav-link icon="arrow-right-end-on-rectangle" href="{% url 'account_login' %}" icon_bg="bg-primary-50" icon_color="text-primary-600">Sign in</c-atoms.nav-link>
        {% endif %}
      </div>
    </div>
  </dialog>
</header>
