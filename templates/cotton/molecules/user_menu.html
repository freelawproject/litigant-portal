{% load heroicons %}
<c-vars />
{% if user.is_authenticated %}
  {# Logged in: show user menu with dropdown #}
  <div x-data="{ open: false }" class="relative {{ class }}" {{ attrs }}>
    <button type="button"
            x-on:click="open = !open"
            x-bind:aria-expanded="open"
            aria-haspopup="true"
            class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-greyscale-700 hover:bg-greyscale-100 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-600">
      {% heroicon_outline "user-circle" class="w-6 h-6 text-greyscale-500" %}
      <span class="hidden sm:inline max-w-[140px] truncate">{{ user.email }}</span>
      {% heroicon_mini "chevron-down" class="w-4 h-4 text-greyscale-400" %}
    </button>
    {# Dropdown menu #}
    <div x-show="open"
         x-cloak
         x-on:click.outside="open = false"
         x-on:keydown.escape.window="open = false"
         x-transition:enter="transition ease-out duration-100"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-75"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95"
         class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-greyscale-200 py-1 z-50"
         role="menu"
         aria-orientation="vertical">
      <a href="{% url 'account_logout' %}"
         class="flex items-center gap-2 px-4 py-2 text-sm text-greyscale-700 hover:bg-greyscale-100"
         role="menuitem">
        {% heroicon_outline "arrow-right-start-on-rectangle" class="w-5 h-5 text-greyscale-500" %}
        Sign out
      </a>
    </div>
  </div>
{% else %}
  {# Not logged in: show sign in link #}
  <a href="{% url 'account_login' %}"
     class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-greyscale-700 hover:bg-greyscale-100 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-600 {{ class }}"
     {{ attrs }}>
    {% heroicon_outline "arrow-right-end-on-rectangle" class="w-5 h-5" %}
    <span>Sign in</span>
  </a>
{% endif %}
